{% extends "base.html" %}

{% block title %}Student Profile{% endblock %}

{% block body %}
    <div class="container mt-4">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <h1 class="mb-4">Student Profile</h1>
                
                <div class="card mb-4">
                    <div class="card-header">
                        <h2 class="card-title mb-0">Student Information</h2>
                    </div>
                    <div class="card-body">
                        <p class="card-text"><strong>Name:</strong> {{ user.get_full_name() }}</p>
                        <p class="card-text"><strong>Email:</strong> {{ user.email }}</p>
                        <p class="card-text"><strong>Student Number:</strong> {{ user.studentnumber if user.studentnumber else "N/A" }}</p>
                    </div>
                </div>

                <div class="card mb-4">
                    <div class="card-header">
                        <h2 class="card-title mb-0">Change Password</h2>
                    </div>
                    <div class="card-body">
                        <form method="post" action="{{ url_for('admin.change_password', user_id=user.id) }}">
                            {{ password_form.hidden_tag() }}
                            <div class="mb-3">
                                {{ password_form.new_password.label(class="form-label") }}
                                {{ password_form.new_password(class="form-control") }}
                                {% if password_form.new_password.errors %}
                                    {% for error in password_form.new_password.errors %}
                                        <div class="text-danger small">{{ error }}</div>
                                    {% endfor %}
                                {% endif %}
                            </div>
                            <button type="submit" class="btn btn-primary">Change Password</button>
                        </form>
                    </div>
                </div>

                <!-- Delete Account Button -->
                <div class="card border-danger mb-4">
                    <div class="card-header bg-danger text-white">
                        <h3 class="card-title mb-0">Danger Zone</h3>
                    </div>
                    <div class="card-body">
                        <p class="card-text">Once you delete this account, there is no going back. Please be certain.</p>
                        <form id="delete-user-form" method="post" action="{{ url_for('admin.delete_user', user_id=user.id) }}" style="display: inline;">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                            <button type="button" onclick="confirmDelete('{{ user.get_full_name() }}', '{{ user.role }}')" 
                                    class="btn btn-danger">
                                Delete Account
                            </button>
                        </form>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title mb-0">Assigned Teacher</h2>
                    </div>
                    <div class="card-body">
                        {% if user.teacher %}
                            <p class="card-text">{{ user.teacher.get_full_name() }} ({{ user.teacher.email }})</p>
                        {% else %}
                            <p class="card-text text-muted">No teacher assigned.</p>
                        {% endif %}
                    </div>
                </div>

                <script>
                    function confirmDelete(userName, userRole) {
                        if (confirm('Are you sure you want to delete this account?\n\nUser: ' + userName + '\nRole: ' + userRole + '\n\nThis action cannot be undone!')) {
                            document.getElementById('delete-user-form').submit();
                        }
                    }
                </script>

                <!-- Add more student-specific info here -->
            </div>
        </div>
    </div>
{% endblock %}
